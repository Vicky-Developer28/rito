{% extends "base.html" %}
{% load static %}

{% block title %}Register - Aegis Sovereign Digital Identity{% endblock %}

{% block extra_css %}
<style>
    .register-container {
        min-height: 100vh;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 58, 138, 0.9) 50%, rgba(30, 64, 175, 0.85) 100%);
        position: relative;
        overflow: hidden;
    }
    
    .register-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('{% static "svg/pattern.svg" %}') center/cover;
        opacity: 0.05;
        z-index: 1;
    }
    
    .register-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        position: relative;
        z-index: 2;
    }
    
    .form-input-enhanced {
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
        color: #1f2937 !important; /* Force dark text color */
    }
    
    .form-input-enhanced::placeholder {
        color: #9ca3af !important; /* Force placeholder color */
    }
    
    .form-input-enhanced:focus {
        background: white;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        transform: translateY(-1px);
        color: #1f2937 !important; /* Ensure text stays dark on focus */
    }
    
    .password-strength {
        height: 4px;
        background: #e2e8f0;
        border-radius: 2px;
        margin-top: 0.5rem;
        overflow: hidden;
    }
    
    .password-strength-bar {
        height: 100%;
        width: 0%;
        transition: all 0.3s ease;
        border-radius: 2px;
    }
    
    .strength-weak { background: #ef4444; width: 25%; }
    .strength-fair { background: #f59e0b; width: 50%; }
    .strength-good { background: #10b981; width: 75%; }
    .strength-strong { background: #10b981; width: 100%; }
    
    .feature-list li {
        position: relative;
        padding-left: 1.5rem;
    }
    
    .feature-list li::before {
        content: 'âœ“';
        position: absolute;
        left: 0;
        color: #10b981;
        font-weight: bold;
    }
    
    .security-badge {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.75rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    
    .floating-icon {
        animation: float 3s ease-in-out infinite;
    }
    
    /* Ensure all form elements have proper text color */
    .form-label {
        color: #374151 !important;
    }
    
    /* Override any base template styles that might affect form text */
    .register-card input,
    .register-card textarea,
    .register-card select {
        color: #1f2937 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="register-container flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl w-full grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Column - Brand & Features -->
        <div class="flex flex-col justify-center space-y-8 text-white">
            <div class="space-y-4">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <img src="{% static 'img/Logo.png' %}" class="w-6 h-6" alt="Aegis Logo">
                    </div>
                    <div class="flex flex-col">
                        <span class="text-2xl font-bold font-moonwalk logo-motion-gradient">Aegis</span>
                        <span class="text-sm font-medium text-blue-200">Innovative</span>
                    </div>
                </div>
                
                <h1 class="text-4xl font-bold leading-tight">
                    Join the Future of <span class="gradient-text">Digital Identity</span>
                </h1>
                <p class="text-lg text-blue-100 leading-relaxed">
                    Create your sovereign digital identity and take control of your personal data with India's most secure identity framework.
                </p>
            </div>

            <div class="space-y-4">
                <div class="security-badge">
                    <i class="fas fa-shield-alt"></i>
                    Military-Grade Encryption
                </div>
                
                <ul class="feature-list space-y-3 text-blue-100">
                    <li>Complete control over your personal data</li>
                    <li>Zero-knowledge proof technology</li>
                    <li>Decentralized identity management</li>
                    <li>Cross-platform compatibility</li>
                    <li>24/7 security monitoring</li>
                    <li>GDPR & Data Protection Act compliant</li>
                </ul>
            </div>

            <div class="flex items-center space-x-4 text-sm text-blue-200">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-users text-blue-400"></i>
                    <span>10,000+ Trusted Users</span>
                </div>
                <div class="flex items-center space-x-2">
                    <i class="fas fa-star text-yellow-400"></i>
                    <span>4.9/5 Rating</span>
                </div>
            </div>
        </div>

        <!-- Right Column - Registration Form -->
        <div class="register-card rounded-2xl p-8 space-y-6">
            <!-- Header -->
            <div class="text-center space-y-3">
                <div class="floating-icon mx-auto w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-user-shield text-white text-2xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-900">
                    Create Account
                </h2>
                <p class="text-gray-600">
                    Join Aegis and start your secure digital identity journey
                </p>
            </div>

            <!-- Messages -->
            {% if messages %}
            <div class="space-y-3">
                {% for message in messages %}
                <div class="p-4 rounded-xl {% if message.tags == 'error' %}bg-red-50 border border-red-200 text-red-700{% else %}bg-green-50 border border-green-200 text-green-700{% endif %}">
                    <div class="flex items-center">
                        <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} mr-3"></i>
                        <span class="font-medium">{{ message }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Registration Form -->
            <form class="space-y-6" method="POST" action="{% url 'user:register' %}">
                {% csrf_token %}
                
                <div class="space-y-5">
                    <!-- Username Field -->
                    <div>
                        <label for="id_username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-user text-gray-400"></i>
                            </div>
                            <input type="text" name="username" id="id_username" required
                                   class="form-input-enhanced pl-10 pr-4 py-3 rounded-xl w-full focus:outline-none"
                                   placeholder="Enter your username"
                                   value="{{ form.username.value|default:'' }}"
                                   style="color: #1f2937 !important;">
                        </div>
                        {% if form.username.errors %}
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            {{ form.username.errors }}
                        </div>
                        {% endif %}
                        <p class="mt-2 text-xs text-gray-500">
                            Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.
                        </p>
                    </div>

                    <!-- Email Field -->
                    <div>
                        <label for="id_email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-envelope text-gray-400"></i>
                            </div>
                            <input type="email" name="email" id="id_email" required
                                   class="form-input-enhanced pl-10 pr-4 py-3 rounded-xl w-full focus:outline-none"
                                   placeholder="your.email@example.com"
                                   value="{{ form.email.value|default:'' }}"
                                   style="color: #1f2937 !important;">
                        </div>
                        {% if form.email.errors %}
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            {{ form.email.errors }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Password Field -->
                    <div>
                        <label for="id_password1" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-lock text-gray-400"></i>
                            </div>
                            <input type="password" name="password1" id="id_password1" required
                                   class="form-input-enhanced pl-10 pr-10 py-3 rounded-xl w-full focus:outline-none"
                                   placeholder="Create a strong password"
                                   style="color: #1f2937 !important;">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <button type="button" class="text-gray-400 hover:text-gray-600 focus:outline-none" onclick="togglePassword('id_password1', this)">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Password Strength Meter -->
                        <div class="password-strength mt-3">
                            <div id="password-strength-bar" class="password-strength-bar"></div>
                        </div>
                        
                        {% if form.password1.errors %}
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            {{ form.password1.errors }}
                        </div>
                        {% endif %}
                        
                        <ul class="mt-3 text-xs text-gray-500 space-y-1">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i> At least 8 characters</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i> Not too common or personal</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2 text-xs"></i> Mix of letters, numbers & symbols</li>
                        </ul>
                    </div>

                    <!-- Confirm Password Field -->
                    <div>
                        <label for="id_password2" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-lock text-gray-400"></i>
                            </div>
                            <input type="password" name="password2" id="id_password2" required
                                   class="form-input-enhanced pl-10 pr-10 py-3 rounded-xl w-full focus:outline-none"
                                   placeholder="Confirm your password"
                                   style="color: #1f2937 !important;">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <button type="button" class="text-gray-400 hover:text-gray-600 focus:outline-none" onclick="togglePassword('id_password2', this)">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        {% if form.password2.errors %}
                        <div class="mt-2 text-sm text-red-600 flex items-center">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            {{ form.password2.errors }}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Terms Agreement -->
                <div class="flex items-start space-x-3 p-4 bg-blue-50 rounded-xl border border-blue-200">
                    <input id="terms" name="terms" type="checkbox" required
                           class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="terms" class="text-sm text-gray-700">
                        I agree to the 
                        <a href="#" class="text-blue-600 hover:text-blue-500 font-medium transition-colors">Terms of Service</a>
                        and 
                        <a href="#" class="text-blue-600 hover:text-blue-500 font-medium transition-colors">Privacy Policy</a>.
                        I understand that my data will be protected with enterprise-grade security measures.
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" 
                        class="w-full py-4 px-6 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                    <div class="flex items-center justify-center space-x-3">
                        <i class="fas fa-user-plus"></i>
                        <span>Create Secure Account</span>
                    </div>
                </button>

                <!-- Login Redirect -->
                <div class="text-center pt-4 border-t border-gray-200">
                    <p class="text-gray-600">
                        Already have an account?
                        <a href="{% url 'user:login' %}" class="text-blue-600 hover:text-blue-500 font-semibold ml-1 transition-colors">
                            Sign in to Aegis
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Password visibility toggle
    function togglePassword(inputId, button) {
        const input = document.getElementById(inputId);
        const icon = button.querySelector('i');
        
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }
    
    // Password strength indicator
    document.getElementById('id_password1').addEventListener('input', function(e) {
        const password = e.target.value;
        const strengthBar = document.getElementById('password-strength-bar');
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength += 25;
        
        // Complexity checks
        if (/[A-Z]/.test(password)) strength += 25;
        if (/[0-9]/.test(password)) strength += 25;
        if (/[^A-Za-z0-9]/.test(password)) strength += 25;
        
        // Update strength bar
        strengthBar.className = 'password-strength-bar';
        if (strength <= 25) {
            strengthBar.classList.add('strength-weak');
        } else if (strength <= 50) {
            strengthBar.classList.add('strength-fair');
        } else if (strength <= 75) {
            strengthBar.classList.add('strength-good');
        } else {
            strengthBar.classList.add('strength-strong');
        }
    });
    
    // Form validation enhancements
    document.querySelector('form').addEventListener('submit', function(e) {
        const password1 = document.getElementById('id_password1').value;
        const password2 = document.getElementById('id_password2').value;
        const terms = document.getElementById('terms').checked;
        
        if (password1 !== password2) {
            e.preventDefault();
            alert('Passwords do not match. Please check and try again.');
            return;
        }
        
        if (!terms) {
            e.preventDefault();
            alert('Please agree to the Terms of Service and Privacy Policy to continue.');
            return;
        }
    });
    
    // Add loading state to form submission
    document.querySelector('form').addEventListener('submit', function() {
        const submitButton = this.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.innerHTML = `
            <div class="flex items-center justify-center space-x-3">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Creating Your Account...</span>
            </div>
        `;
    });
</script>
{% endblock %}