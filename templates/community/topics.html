{% extends 'base.html' %}
{% load static %}

{% block title %}Topics - Rito Community{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-slate-900 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Browse Topics</h1>
            <p class="text-gray-600 dark:text-gray-400">Explore questions by topics you're interested in</p>
        </div>

        <!-- Search -->
        <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-slate-700 mb-6">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <input type="text" 
                       placeholder="Search topics..." 
                       class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-800 text-gray-900 dark:text-white">
            </div>
        </div>

        <!-- Topics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for topic in topics %}
            <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-slate-700 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                        <a href="{% url 'user:topic_detail' topic.slug %}" class="hover:underline">
                            #{{ topic.name }}
                        </a>
                    </h3>
                    <button class="follow-topic-btn p-2 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors rounded-full hover:bg-gray-100 dark:hover:bg-slate-700" data-topic-id="{{ topic.id }}">
                        <i class="far fa-bell"></i>
                    </button>
                </div>
                
                {% if topic.description %}
                <p class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-2">{{ topic.description }}</p>
                {% endif %}
                
                <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                    <div class="flex items-center space-x-4">
                        <span class="flex items-center space-x-1">
                            <i class="far fa-question-circle"></i>
                            <span>{{ topic.questions_count }} questions</span>
                        </span>
                        <span class="flex items-center space-x-1">
                            <i class="far fa-user"></i>
                            <span>{{ topic.followers_count }} followers</span>
                        </span>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-3 bg-white dark:bg-slate-800 rounded-xl p-8 text-center shadow-sm border border-gray-200 dark:border-slate-700">
                <i class="fas fa-tags text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No topics yet</h3>
                <p class="text-gray-600 dark:text-gray-400">Topics will appear as questions are posted in the community.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Follow topic functionality
        document.querySelectorAll('.follow-topic-btn').forEach(button => {
            button.addEventListener('click', function() {
                const topicId = this.dataset.topicId;
                followTopic(topicId);
            });
        });

        // Search functionality
        const searchInput = document.querySelector('input[type="text"]');
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            document.querySelectorAll('.bg-white.rounded-xl').forEach(card => {
                const topicName = card.querySelector('h3').textContent.toLowerCase();
                if (topicName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });

    function followTopic(topicId) {
        fetch(`/community/topic/${topicId}/follow/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const followIcon = document.querySelector(`[data-topic-id="${topicId}"] i`);
                if (data.following) {
                    followIcon.classList.remove('far');
                    followIcon.classList.add('fas');
                    followIcon.style.color = '#3b82f6';
                } else {
                    followIcon.classList.remove('fas');
                    followIcon.classList.add('far');
                    followIcon.style.color = '';
                }
            }
        });
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}